---
steps:
  - label: "Linting :lint-roller:"
    command: "git diff-tree --no-commit-id --name-only -r ${BUILDKITE_COMMIT} | xargs pre-commit run --files"
  - label: "Test"
    branches: "*"
    command:
      - "npm ci"
      - "npm test"
    plugins:
      - docker#v3.7.0:
          always-pull: true
          propagate-uid-gid: true
          volumes:
            - $HOME/.npm:/.npm
            - $HOME/.npmrc:/workdir/.npmrc:ro
          image: "node:12-buster"
  #  - label: "Sonar"
  #    branches: "develop"
  #    commands:
  #      - "mvn clean verify"
  - wait
  - label: "Publish"
    branches: "develop v*.*.*"
    commands:
      - "npm publish"
      - "npm run scope"
      - "npm publish"
    plugins:
      - docker#v3.7.0:
          always-pull: true
          propagate-uid-gid: true
          volumes:
            - $HOME/.npm:/.npm
            - $HOME/.npmrc:/workdir/.npmrc:ro
          image: "node:12-buster"
